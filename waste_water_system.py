


"""
Classic cart-pole system implemented by Rich Sutton et al.
Copied from http://incompleteideas.net/sutton/book/code/pole.c
permalink: https://perma.cc/C9ZM-652R
"""

import math
import gym
from gym import spaces, logger
from gym.utils import seeding
import numpy as np
import csv
import matplotlib.pyplot as plt
import envs.mpctools as mpc

class waste_water_system(gym.Env):

    def __init__(self, ref = np.array([1, 2]), Nx: int | None = None):
        self.t = 0
        self.real_world_time = 0  # second

        self.action_sample_period = 30
        self.sampling_period = (1 / 24 / 60) * 15 # 15 min
        self.h = 1 / 24 / 60 # 1 min
        self.sampling_steps = int(self.sampling_period/self.h)
        self.delay = 0
        Delta = 1
        Nx = 145 if Nx is None else int(Nx)
        Nu = 16
        try:
            self.x0 = np.loadtxt('envs/ss_open.txt')
            data = np.loadtxt('envs/Inf_dry_2006.txt')
        except:
            self.x0 = np.loadtxt('ss_open.txt')
            data = np.loadtxt('Inf_dry_2006.txt')

        x0_len = self.x0.shape[0]
        if x0_len != Nx:
            raise ValueError(
                f"Steady-state length {x0_len} does not match Nx={Nx}. "
                "Update the Nx argument (and related simulator settings) to align with the provided steady-state file."
            )
        self.observed_dims = [21, 59]

        self.Q0 = data[:, 14][:, np.newaxis]
        self.Z0 = data[:, 1:14]

        # self.Q0_noise_scale = np.mean(self.Q0)*0.005
        # self.Z0_noise_scale = np.var(self.Z0, axis=0) * 0.01
        #
        # self.Q0_noise = np.random.normal(0, self.Q0_noise_scale, self.Q0.shape)
        # self.Z0_noise = np.random.normal(0, self.Z0_noise_scale, self.Z0.shape)
        #
        # self.Q0 = np.clip(self.Q0 + self.Q0_noise, self.Q0.min(), None)
        # self.Z0 = np.clip(self.Z0 + self.Z0_noise, self.Z0.min(axis=0), None)
        ##visualize the data


        yset1 = 0.7078 #x60 setpoint 
        yset2 = 2.1345 #x22 setpoint

        # yset1 = 0.65 #x60 setpoint 
        # yset2 = 4.31 #x22 setpoint

        # yset1 = 2 #x60 setpoint 
        # yset2 = 1 #x22 setpoint


        self.xs = np.array([yset1,yset2])

        self.us = np.array([131.65, 16485.6074])

        self.wwtp_sim = mpc.DiscreteSimulator(ode_bsm1model, Delta, [Nx, Nu], ["x", "u"])

        # high = np.array(np.ones(len(self.observed_dims) + 1 + self.Z0.shape[1]))
        high = np.array(np.ones(Nx + 1 + self.Z0.shape[1]))

        # self.action_low = np.array([40, 1.2e+03])
        # self.action_high = np.array([250, 4.6e+04])

        self.action_low = np.array([0, 0])
        self.action_high = np.array([240, 5 * 18446])

        self.reference = ref

        self.action_space = spaces.Box(low=self.action_low, high=self.action_high, dtype=np.float32)
        self.observation_space = spaces.Box(-high, high, dtype=np.float32)

        self.seed()
        self.viewer = None
        self.state = None
        self.state_buffer = state_buffer(self.delay)

        self.steps_beyond_done = None


        self.all_state = 145+1
        self.pred_index = set(np.arange(self.all_state))
        self.cont_index = set([ 0,  13,  26,  39,  52,  75,  76,  77,  78,  79,  80,  81,  82,  83,  84])
        self.pred_tracking = np.array(list(self.pred_index-self.cont_index))
        self.state_use = self.pred_tracking.shape[0]

        self.state_tracking  = np.array([59,21])
        self.state_tracking_c= np.array([54,19])
        self.draw_state      = np.array([1,20,21,22,53,54,55,145])
        self.draw_state_c    = np.array([0,18,19,20,48,49,50,130])
        self.draw_state_num  = self.draw_state.shape[0]

    def seed(self, seed=None):
        self.np_random, seed = seeding.np_random(seed)
        return [seed]



    def step(self, action, impulse = 0):

        input = np.concatenate([np.clip(action[:2], self.action_low, self.action_high),action[2:]])
        # input = np.concatenate((action, self.Q0[self.t], self.Z0[self.t]))
        self.state = self.wwtp_sim.sim(self.state, input)
        
        # if self.apply_noise:
        #     self.state = self.state + np.random.normal(np.zeros_like(self.state), self.w_sigma)

        self.state_buffer.memorize(self.state)

        s = self.observe()
        self.t += 1
        self.time = self.t * self.sampling_period
        s_attention = [self.state[59],self.state[21]]
        cost = np.linalg.norm(s_attention - self.xs)
        #----------------------cost--------------------#
 
        ref_attention = []
        self.cost_use = 0
        # print(cost)

        cost, EQk , AEk , PEk , SPk , MEk  = self.cost(self.state, action, action[2:])

        self.cost_every = [EQk , AEk , PEk , SPk , MEk]

        done = False
        data_collection_done = False

        if self.t == self.Q0.shape[0]:
            done = True
            data_collection_done = True
        
        self.x = s

        
        return s, cost, done, dict(reference=self.reference, data_collection_done=data_collection_done)
    

    def cost(self, x, u, p = None):

        Qw = 385
        Qr = 18446
        Q0 = p[0]
        Qe = Q0 - Qw

        # define parameter value
        iXB = 0.08
        iXP = 0.06
        fP = 0.08
        V1 = 1000
        V2 = 1000
        V3 = 1333
        V4 = 1333
        V5 = 1333
        SO_star = 8
        zm = 0.4
        A = 1500
        KLa3 = 240
        KLa4 = 240
        TSS0 = 2.4693e+07

        SNHe = x[124]
        SNDe = x[134]
        SSe = x[94]
        SIe = x[84]
        SNOe = x[114]

        # XNDe XBHe XBAe XPe XIe XSe
        XI5 = x[54]
        XS5 = x[55]
        XBH5 = x[56]
        XBA5 = x[57]
        XP5 = x[58]
        XND5 = x[63]
        Xe = x[74]
        Xf = 0.75 * (XI5 + XS5 + XBH5 + XBA5 + XP5)
        XNDe = (Xe / Xf) * XND5
        XBHe = (Xe / Xf) * XBH5
        XBAe = (Xe / Xf) * XBA5
        XPe = (Xe / Xf) * XP5
        XIe = (Xe / Xf) * XI5
        XSe = (Xe / Xf) * XS5

        ## EQ ---------------------------------------------------------------##
        SNKje = SNHe + SNDe + XNDe + iXB * (XBHe + XBAe) + iXP * (XPe + XIe)
        CODe = SSe + SIe + XSe + XIe + XBHe + XBAe + XPe
        BOD5e = 0.25 * (SSe + XSe + (1 - fP) * (XBHe + XBAe))
        TSSe = Xe

        # KLa5 = 94.5898 * u[0]
        # Qa = 32834.8542 * u[1]

        KLa5 = u[0]
        Qa = u[1]

        EQk = (2 * TSSe + CODe + 30 * SNKje + 10 * (SNOe) + 2 * BOD5e) * Qe / 1000

        ## OCI --------------------------------------------------------------##
        TSSak = 0.75 * (V1 * (x[2] + x[3] + x[4] + x[5] + x[6]) + \
                        V2 * (x[15] + x[16] + x[17] + x[18] + x[19]) + \
                        V3 * (x[28] + x[29] + x[30] + x[31] + x[32]) + \
                        V4 * (x[41] + x[42] + x[43] + x[44] + x[45]) + \
                        V5 * (x[54] + x[55] + x[56] + x[57] + x[58]))

        TSSsk = zm * A * (x[65] + x[66] + x[67] + x[68] + x[69] + x[70] + x[71] + x[72] + x[73] + x[74])
        TSSk = TSSak + TSSsk

        SPk = (TSSk - TSS0 + x[65] * Qw) / 1000
        PEk = 0.004 * Qa + 0.008 * Qr + 0.05 * Qw
        # PEk = 0.008 * Qr + 0.05 * Qw ## no action effect
        AEk = SO_star / 1.8 / 1000 * (V3 * KLa3 + V4 * KLa4 + V5 * KLa5)
        # AEk = SO_star / 1.8 / 1000 * (V3 * KLa3 + V4 * KLa4) ##  no action effect
        MEk = 24 * 0.005 * (V1 + V2)

        OCIk = AEk + PEk + 5 * SPk + MEk

        return (EQk + OCIk * 0.3) / 100000, EQk / 100000, AEk / 100000, PEk / 100000, SPk / 100000, MEk / 100000

    def observe(self):
        '''
        A function that picks the observed states from the state vector. The dimensions to be observed are specified by self.observed_dims.
        Returns:

        '''
        x = self.state
        # y = np.zeros(len(self.observed_dims))
        # for i in range(len(self.observed_dims)):
        #     y[i] = x[self.observed_dims[i]]
        y = np.concatenate((x, self.Q0[self.t], self.Z0[self.t]))
        return y

    def reset(self,test = False,iter=1):

        self.state_buffer.reset()
        self.t = 0
        self.time = 0
        self.a_holder = self.action_space.sample()
        self.state = self.x0 #+ np.random.normal(np.zeros_like(self.x0), self.x0*0.01)
        # d = np.concatenate((self.Q0[self.t], self.Z0[self.t]))
        # self.t += 1
        # action = self.action_space.sample()
        # for i in range(self.sampling_steps):
        #     # process_noise = np.random.normal(np.zeros_like(self.kw), self.kw)
        #     # process_noise = np.clip(process_noise, -self.bw, self.bw)
        #     self.state = self.state + ode_bsm1model(self.state, action, d) * self.h #+ process_noise * self.h
        
        
        self.time = self.t * self.sampling_period
        s = self.observe()
        return s


    
    def render(self, mode='human'):

        return


    def get_action(self):

        if self.t % self.action_sample_period == 0:
            self.a_holder = self.action_space.sample()
        a = self.a_holder + np.random.normal(np.zeros_like(self.us), self.us*0.01)
        a = np.clip(a, self.action_low, self.action_high)

        return a

class state_buffer(object):

    def __init__(self, delay):

        self.delay = delay
        self.memory = []


    def memorize(self, s):

        self.memory.append(s)
        return

    def get_state(self, t):

        if t < self.delay:
            return None
        else:
            return self.memory[t]

    def reset(self):
        self.memory = []


def ode_bsm1model(x, u):
    ## System parameters
    #    YA = 0.24
    #    YH = 0.67
    #    fP = 0.08
    #    iXB = 0.08
    #    iXP = 0.06
    #    muH = 4.0
    #    KS = 10.0
    #    KOH = 0.2
    #    KNO = 0.5
    #    bH = 0.3
    #    etag = 0.8
    #    etah = 0.8
    #    kh = 3.0
    #    KX = 0.1
    #    muA = 0.5
    #    KNH = 1.0
    #    bA = 0.05
    #    KOA = 0.4
    #    ka = 0.05
    #
    ## Secondary settler: table 4
    #    v0_pie = 250
    #    v0 = 474
    #    rh = 0.000576
    #    rp = 0.00286
    #    fns = 0.00228
    #
    ## Else
    #    V1 = 1000
    #    V2 = 1000
    #    V3 = 1333
    #    V4 = 1333
    #    V5 = 1333
    #    SO_star = 8
    #    A = 1500
    #    Xt = 3000
    #    zm = 0.4
    #    KLa3 = 240
    #    KLa4 = 240
    #
    #
    #
    #
    # Input  16 variables
    KLa5 = u[0]
    Qa = u[1]


    Q0 = u[2]
    Z0 = u[3:]
    #
    #    Qr = 18446
    #    Qw = 385
    #    Qe = Q0 - Qw
    #    Q1 = Q0 + Qa + Qr
    #    Qf = Q1 - Qa
    #    Q2 = Q1
    #    Q3 = Q2
    #    Q4 = Q3
    #    Q5 = Q4

    x1 = x[0]
    x2 = x[1]
    x3 = x[2]
    x4 = x[3]
    x5 = x[4]
    x6 = x[5]
    x7 = x[6]
    x8 = x[7]
    x9 = x[8]
    x10 = x[9]
    x11 = x[10]
    x12 = x[11]
    x13 = x[12]
    x14 = x[13]
    x15 = x[14]
    x16 = x[15]
    x17 = x[16]
    x18 = x[17]
    x19 = x[18]
    x20 = x[19]
    x21 = x[20]
    x22 = x[21]
    x23 = x[22]
    x24 = x[23]
    x25 = x[24]
    x26 = x[25]
    x27 = x[26]
    x28 = x[27]
    x29 = x[28]
    x30 = x[29]
    x31 = x[30]
    x32 = x[31]
    x33 = x[32]
    x34 = x[33]
    x35 = x[34]
    x36 = x[35]
    x37 = x[36]
    x38 = x[37]
    x39 = x[38]
    x40 = x[39]
    x41 = x[40]
    x42 = x[41]
    x43 = x[42]
    x44 = x[43]
    x45 = x[44]
    x46 = x[45]
    x47 = x[46]
    x48 = x[47]
    x49 = x[48]
    x50 = x[49]
    x51 = x[50]
    x52 = x[51]
    x53 = x[52]
    x54 = x[53]
    x55 = x[54]
    x56 = x[55]
    x57 = x[56]
    x58 = x[57]
    x59 = x[58]
    x60 = x[59]
    x61 = x[60]
    x62 = x[61]
    x63 = x[62]
    x64 = x[63]
    x65 = x[64]
    x66 = x[65]
    x67 = x[66]
    x68 = x[67]
    x69 = x[68]
    x70 = x[69]
    x71 = x[70]
    x72 = x[71]
    x73 = x[72]
    x74 = x[73]
    x75 = x[74]
    x76 = x[75]
    x77 = x[76]
    x78 = x[77]
    x79 = x[78]
    x80 = x[79]
    x81 = x[80]
    x82 = x[81]
    x83 = x[82]
    x84 = x[83]
    x85 = x[84]
    x86 = x[85]
    x87 = x[86]
    x88 = x[87]
    x89 = x[88]
    x90 = x[89]
    x91 = x[90]
    x92 = x[91]
    x93 = x[92]
    x94 = x[93]
    x95 = x[94]
    x96 = x[95]
    x97 = x[96]
    x98 = x[97]
    x99 = x[98]
    x100 = x[99]
    x101 = x[100]
    x102 = x[101]
    x103 = x[102]
    x104 = x[103]
    x105 = x[104]
    x106 = x[105]
    x107 = x[106]
    x108 = x[107]
    x109 = x[108]
    x110 = x[109]
    x111 = x[110]
    x112 = x[111]
    x113 = x[112]
    x114 = x[113]
    x115 = x[114]
    x116 = x[115]
    x117 = x[116]
    x118 = x[117]
    x119 = x[118]
    x120 = x[119]
    x121 = x[120]
    x122 = x[121]
    x123 = x[122]
    x124 = x[123]
    x125 = x[124]
    x126 = x[125]
    x127 = x[126]
    x128 = x[127]
    x129 = x[128]
    x130 = x[129]
    x131 = x[130]
    x132 = x[131]
    x133 = x[132]
    x134 = x[133]
    x135 = x[134]
    x136 = x[135]
    x137 = x[136]
    x138 = x[137]
    x139 = x[138]
    x140 = x[139]
    x141 = x[140]
    x142 = x[141]
    x143 = x[142]
    x144 = x[143]
    x145 = x[144]

    Z01 = Z0[0]
    Z02 = Z0[1]
    Z03 = Z0[2]
    Z04 = Z0[3]
    Z05 = Z0[4]
    Z06 = Z0[5]
    Z07 = Z0[6]
    Z08 = Z0[7]
    Z09 = Z0[8]
    Z010 = Z0[9]
    Z011 = Z0[10]
    Z012 = Z0[11]
    Z013 = Z0[12]

    dxdt = [
        1 / 96 * ((9223 * x76) / 500 + (Q0 * Z01) / 1000 + (Qa * x53) / 1000 - (x1 * (Q0 + Qa + 18446)) / 1000),
        1 / 96 * ((9223 * x86) / 500 + (Q0 * Z02) / 1000 + (Qa * x54) / 1000 - (x2 * (Q0 + Qa + 18446)) / 1000 + (
                    3 * x4 * (x8 / (x8 + 1 / 5) + (4 * x9) / (25 * (x9 + 1 / 2) * (x8 + 1 / 5)))) / (
                              x4 / x5 + 1 / 10) - (400 * x2 * x5 * x8) / (67 * (x2 + 10) * (x8 + 1 / 5)) - (
                              64 * x2 * x5 * x9) / (67 * (x2 + 10) * (x9 + 1 / 2) * (x8 + 1 / 5))),
        1 / 96 * ((Q0 * Z03) / 1000 + (Qa * x55) / 1000 - (x3 * (Q0 + Qa + 18446)) / 1000 + (9223 * x55 * x66) / (
                    500 * ((3 * x55) / 4 + (3 * x56) / 4 + (3 * x57) / 4 + (3 * x58) / 4 + (3 * x59) / 4))),
        1 / 96 * ((69 * x5) / 250 + (23 * x6) / 500 + (Q0 * Z04) / 1000 + (Qa * x56) / 1000 - (
                    x4 * (Q0 + Qa + 18446)) / 1000 + (9223 * x56 * x66) / (
                              500 * ((3 * x55) / 4 + (3 * x56) / 4 + (3 * x57) / 4 + (3 * x58) / 4 + (3 * x59) / 4)) - (
                              3 * x4 * (x8 / (x8 + 1 / 5) + (4 * x9) / (25 * (x9 + 1 / 2) * (x8 + 1 / 5)))) / (
                              x4 / x5 + 1 / 10)),
        1 / 96 * ((Q0 * Z05) / 1000 - (3 * x5) / 10 + (Qa * x57) / 1000 - (x5 * (Q0 + Qa + 18446)) / 1000 + (
                    9223 * x57 * x66) / (
                              500 * ((3 * x55) / 4 + (3 * x56) / 4 + (3 * x57) / 4 + (3 * x58) / 4 + (3 * x59) / 4)) + (
                              4 * x2 * x5 * x8) / ((x2 + 10) * (x8 + 1 / 5)) + (16 * x2 * x5 * x9) / (
                              25 * (x2 + 10) * (x9 + 1 / 2) * (x8 + 1 / 5))),
        1 / 96 * ((Q0 * Z06) / 1000 - x6 / 20 + (Qa * x58) / 1000 - (x6 * (Q0 + Qa + 18446)) / 1000 + (
                    9223 * x58 * x66) / (
                              500 * ((3 * x55) / 4 + (3 * x56) / 4 + (3 * x57) / 4 + (3 * x58) / 4 + (3 * x59) / 4)) + (
                              x6 * x8 * x10) / (2 * (x10 + 1) * (x8 + 2 / 5))),
        1 / 96 * ((3 * x5) / 125 + x6 / 250 + (Q0 * Z07) / 1000 + (Qa * x59) / 1000 - (
                    x7 * (Q0 + Qa + 18446)) / 1000 + (9223 * x59 * x66) / (
                              500 * ((3 * x55) / 4 + (3 * x56) / 4 + (3 * x57) / 4 + (3 * x58) / 4 + (3 * x59) / 4))),
        1 / 96 * ((9223 * x96) / 500 + (Q0 * Z08) / 1000 + (Qa * x60) / 1000 - (x8 * (Q0 + Qa + 18446)) / 1000 - (
                    132 * x2 * x5 * x8) / (67 * (x2 + 10) * (x8 + 1 / 5)) - (433 * x6 * x8 * x10) / (
                              48 * (x10 + 1) * (x8 + 2 / 5))),
        1 / 96 * ((9223 * x106) / 500 + (Q0 * Z09) / 1000 + (Qa * x61) / 1000 - (x9 * (Q0 + Qa + 18446)) / 1000 + (
                    25 * x6 * x8 * x10) / (12 * (x10 + 1) * (x8 + 2 / 5)) - (96 * x2 * x5 * x9) / (
                              871 * (x2 + 10) * (x9 + 1 / 2) * (x8 + 1 / 5))),
        1 / 96 * ((9223 * x116) / 500 + (Q0 * Z010) / 1000 + (Qa * x62) / 1000 + (x5 * x11) / 20 - (
                    x10 * (Q0 + Qa + 18446)) / 1000 - (8 * x2 * x5 * x8) / (25 * (x2 + 10) * (x8 + 1 / 5)) - (
                              637 * x6 * x8 * x10) / (300 * (x10 + 1) * (x8 + 2 / 5)) - (32 * x2 * x5 * x9) / (
                              625 * (x2 + 10) * (x9 + 1 / 2) * (x8 + 1 / 5))),
        1 / 96 * ((9223 * x126) / 500 + (Q0 * Z011) / 1000 + (Qa * x63) / 1000 - (x5 * x11) / 20 - (
                    x11 * (Q0 + Qa + 18446)) / 1000 + (
                              3 * x12 * (x8 / (x8 + 1 / 5) + (4 * x9) / (25 * (x9 + 1 / 2) * (x8 + 1 / 5)))) / (
                              x4 / x5 + 1 / 10)),
        1 / 96 * ((141 * x5) / 6250 + (47 * x6) / 12500 + (Q0 * Z012) / 1000 + (Qa * x64) / 1000 - (
                    x12 * (Q0 + Qa + 18446)) / 1000 + (9223 * x64 * x66) / (
                              500 * ((3 * x55) / 4 + (3 * x56) / 4 + (3 * x57) / 4 + (3 * x58) / 4 + (3 * x59) / 4)) - (
                              3 * x12 * (x8 / (x8 + 1 / 5) + (4 * x9) / (25 * (x9 + 1 / 2) * (x8 + 1 / 5)))) / (
                              x4 / x5 + 1 / 10)),
        1 / 96 * ((9223 * x136) / 500 + (Q0 * Z013) / 1000 + (Qa * x65) / 1000 + (x5 * x11) / 280 - (
                    x13 * (Q0 + Qa + 18446)) / 1000 - (4 * x2 * x5 * x8) / (175 * (x2 + 10) * (x8 + 1 / 5)) - (
                              631 * x6 * x8 * x10) / (2100 * (x10 + 1) * (x8 + 2 / 5)) + (
                              1518823277841921 * x2 * x5 * x9) / (
                              360287970189639680 * (x2 + 10) * (x9 + 1 / 2) * (x8 + 1 / 5))),
        1 / 96 * ((x1 * (Q0 + Qa + 18446)) / 1000 - (x14 * (Q0 + Qa + 18446)) / 1000),
        1 / 96 * ((x2 * (Q0 + Qa + 18446)) / 1000 - (x15 * (Q0 + Qa + 18446)) / 1000 + (
                    3 * x17 * (x21 / (x21 + 1 / 5) + (4 * x22) / (25 * (x22 + 1 / 2) * (x21 + 1 / 5)))) / (
                              x17 / x18 + 1 / 10) - (400 * x15 * x18 * x21) / (67 * (x15 + 10) * (x21 + 1 / 5)) - (
                              64 * x15 * x18 * x22) / (67 * (x15 + 10) * (x22 + 1 / 2) * (x21 + 1 / 5))),
        1 / 96 * ((x3 * (Q0 + Qa + 18446)) / 1000 - (x16 * (Q0 + Qa + 18446)) / 1000),
        1 / 96 * ((69 * x18) / 250 + (23 * x19) / 500 + (x4 * (Q0 + Qa + 18446)) / 1000 - (
                    x17 * (Q0 + Qa + 18446)) / 1000 - (
                              3 * x17 * (x21 / (x21 + 1 / 5) + (4 * x22) / (25 * (x22 + 1 / 2) * (x21 + 1 / 5)))) / (
                              x17 / x18 + 1 / 10)),
        1 / 96 * ((x5 * (Q0 + Qa + 18446)) / 1000 - (3 * x18) / 10 - (x18 * (Q0 + Qa + 18446)) / 1000 + (
                    4 * x15 * x18 * x21) / ((x15 + 10) * (x21 + 1 / 5)) + (16 * x15 * x18 * x22) / (
                              25 * (x15 + 10) * (x22 + 1 / 2) * (x21 + 1 / 5))),
        1 / 96 * ((x6 * (Q0 + Qa + 18446)) / 1000 - x19 / 20 - (x19 * (Q0 + Qa + 18446)) / 1000 + (x19 * x21 * x23) / (
                    2 * (x23 + 1) * (x21 + 2 / 5))),
        1 / 96 * ((3 * x18) / 125 + x19 / 250 + (x7 * (Q0 + Qa + 18446)) / 1000 - (x20 * (Q0 + Qa + 18446)) / 1000),
        1 / 96 * ((x8 * (Q0 + Qa + 18446)) / 1000 - (x21 * (Q0 + Qa + 18446)) / 1000 - (132 * x15 * x18 * x21) / (
                    67 * (x15 + 10) * (x21 + 1 / 5)) - (433 * x19 * x21 * x23) / (48 * (x23 + 1) * (x21 + 2 / 5))),
        1 / 96 * ((x9 * (Q0 + Qa + 18446)) / 1000 - (x22 * (Q0 + Qa + 18446)) / 1000 + (25 * x19 * x21 * x23) / (
                    12 * (x23 + 1) * (x21 + 2 / 5)) - (96 * x15 * x18 * x22) / (
                              871 * (x15 + 10) * (x22 + 1 / 2) * (x21 + 1 / 5))),
        1 / 96 * ((x18 * x24) / 20 + (x10 * (Q0 + Qa + 18446)) / 1000 - (x23 * (Q0 + Qa + 18446)) / 1000 - (
                    8 * x15 * x18 * x21) / (25 * (x15 + 10) * (x21 + 1 / 5)) - (637 * x19 * x21 * x23) / (
                              300 * (x23 + 1) * (x21 + 2 / 5)) - (32 * x15 * x18 * x22) / (
                              625 * (x15 + 10) * (x22 + 1 / 2) * (x21 + 1 / 5))),
        1 / 96 * ((x11 * (Q0 + Qa + 18446)) / 1000 - (x18 * x24) / 20 - (x24 * (Q0 + Qa + 18446)) / 1000 + (
                    3 * x25 * (x21 / (x21 + 1 / 5) + (4 * x22) / (25 * (x22 + 1 / 2) * (x21 + 1 / 5)))) / (
                              x17 / x18 + 1 / 10)),
        1 / 96 * ((141 * x18) / 6250 + (47 * x19) / 12500 + (x12 * (Q0 + Qa + 18446)) / 1000 - (
                    x25 * (Q0 + Qa + 18446)) / 1000 - (
                              3 * x25 * (x21 / (x21 + 1 / 5) + (4 * x22) / (25 * (x22 + 1 / 2) * (x21 + 1 / 5)))) / (
                              x17 / x18 + 1 / 10)),
        1 / 96 * ((x18 * x24) / 280 + (x13 * (Q0 + Qa + 18446)) / 1000 - (x26 * (Q0 + Qa + 18446)) / 1000 - (
                    4 * x15 * x18 * x21) / (175 * (x15 + 10) * (x21 + 1 / 5)) - (631 * x19 * x21 * x23) / (
                              2100 * (x23 + 1) * (x21 + 2 / 5)) + (1518823277841921 * x15 * x18 * x22) / (
                              360287970189639680 * (x15 + 10) * (x22 + 1 / 2) * (x21 + 1 / 5))),
        1 / 96 * ((x14 * (Q0 + Qa + 18446)) / 1333 - (x27 * (Q0 + Qa + 18446)) / 1333),
        1 / 96 * ((x15 * (Q0 + Qa + 18446)) / 1333 - (x28 * (Q0 + Qa + 18446)) / 1333 + (
                    3 * x30 * (x34 / (x34 + 1 / 5) + (4 * x35) / (25 * (x35 + 1 / 2) * (x34 + 1 / 5)))) / (
                              x30 / x31 + 1 / 10) - (400 * x28 * x31 * x34) / (67 * (x28 + 10) * (x34 + 1 / 5)) - (
                              64 * x28 * x31 * x35) / (67 * (x28 + 10) * (x35 + 1 / 2) * (x34 + 1 / 5))),
        1 / 96 * ((x16 * (Q0 + Qa + 18446)) / 1333 - (x29 * (Q0 + Qa + 18446)) / 1333),
        1 / 96 * ((69 * x31) / 250 + (23 * x32) / 500 + (x17 * (Q0 + Qa + 18446)) / 1333 - (
                    x30 * (Q0 + Qa + 18446)) / 1333 - (
                              3 * x30 * (x34 / (x34 + 1 / 5) + (4 * x35) / (25 * (x35 + 1 / 2) * (x34 + 1 / 5)))) / (
                              x30 / x31 + 1 / 10)),
        1 / 96 * ((x18 * (Q0 + Qa + 18446)) / 1333 - (3 * x31) / 10 - (x31 * (Q0 + Qa + 18446)) / 1333 + (
                    4 * x28 * x31 * x34) / ((x28 + 10) * (x34 + 1 / 5)) + (16 * x28 * x31 * x35) / (
                              25 * (x28 + 10) * (x35 + 1 / 2) * (x34 + 1 / 5))),
        1 / 96 * ((x19 * (Q0 + Qa + 18446)) / 1333 - x32 / 20 - (x32 * (Q0 + Qa + 18446)) / 1333 + (x32 * x34 * x36) / (
                    2 * (x36 + 1) * (x34 + 2 / 5))),
        1 / 96 * ((3 * x31) / 125 + x32 / 250 + (x20 * (Q0 + Qa + 18446)) / 1333 - (x33 * (Q0 + Qa + 18446)) / 1333),
        1 / 96 * ((x21 * (Q0 + Qa + 18446)) / 1333 - 240 * x34 - (x34 * (Q0 + Qa + 18446)) / 1333 - (
                    132 * x28 * x31 * x34) / (67 * (x28 + 10) * (x34 + 1 / 5)) - (433 * x32 * x34 * x36) / (
                              48 * (x36 + 1) * (x34 + 2 / 5)) + 1920),
        1 / 96 * ((x22 * (Q0 + Qa + 18446)) / 1333 - (x35 * (Q0 + Qa + 18446)) / 1333 + (25 * x32 * x34 * x36) / (
                    12 * (x36 + 1) * (x34 + 2 / 5)) - (96 * x28 * x31 * x35) / (
                              871 * (x28 + 10) * (x35 + 1 / 2) * (x34 + 1 / 5))),
        1 / 96 * ((x31 * x37) / 20 + (x23 * (Q0 + Qa + 18446)) / 1333 - (x36 * (Q0 + Qa + 18446)) / 1333 - (
                    8 * x28 * x31 * x34) / (25 * (x28 + 10) * (x34 + 1 / 5)) - (637 * x32 * x34 * x36) / (
                              300 * (x36 + 1) * (x34 + 2 / 5)) - (32 * x28 * x31 * x35) / (
                              625 * (x28 + 10) * (x35 + 1 / 2) * (x34 + 1 / 5))),
        1 / 96 * ((x24 * (Q0 + Qa + 18446)) / 1333 - (x31 * x37) / 20 - (x37 * (Q0 + Qa + 18446)) / 1333 + (
                    3 * x38 * (x34 / (x34 + 1 / 5) + (4 * x35) / (25 * (x35 + 1 / 2) * (x34 + 1 / 5)))) / (
                              x30 / x31 + 1 / 10)),
        1 / 96 * ((141 * x31) / 6250 + (47 * x32) / 12500 + (x25 * (Q0 + Qa + 18446)) / 1333 - (
                    x38 * (Q0 + Qa + 18446)) / 1333 - (
                              3 * x38 * (x34 / (x34 + 1 / 5) + (4 * x35) / (25 * (x35 + 1 / 2) * (x34 + 1 / 5)))) / (
                              x30 / x31 + 1 / 10)),
        1 / 96 * ((x31 * x37) / 280 + (x26 * (Q0 + Qa + 18446)) / 1333 - (x39 * (Q0 + Qa + 18446)) / 1333 - (
                    4 * x28 * x31 * x34) / (175 * (x28 + 10) * (x34 + 1 / 5)) - (631 * x32 * x34 * x36) / (
                              2100 * (x36 + 1) * (x34 + 2 / 5)) + (1518823277841921 * x28 * x31 * x35) / (
                              360287970189639680 * (x28 + 10) * (x35 + 1 / 2) * (x34 + 1 / 5))),
        1 / 96 * ((x27 * (Q0 + Qa + 18446)) / 1333 - (x40 * (Q0 + Qa + 18446)) / 1333),
        1 / 96 * ((x28 * (Q0 + Qa + 18446)) / 1333 - (x41 * (Q0 + Qa + 18446)) / 1333 + (
                    3 * x43 * (x47 / (x47 + 1 / 5) + (4 * x48) / (25 * (x48 + 1 / 2) * (x47 + 1 / 5)))) / (
                              x43 / x44 + 1 / 10) - (400 * x41 * x44 * x47) / (67 * (x41 + 10) * (x47 + 1 / 5)) - (
                              64 * x41 * x44 * x48) / (67 * (x41 + 10) * (x48 + 1 / 2) * (x47 + 1 / 5))),
        1 / 96 * ((x29 * (Q0 + Qa + 18446)) / 1333 - (x42 * (Q0 + Qa + 18446)) / 1333),
        1 / 96 * ((69 * x44) / 250 + (23 * x45) / 500 + (x30 * (Q0 + Qa + 18446)) / 1333 - (
                    x43 * (Q0 + Qa + 18446)) / 1333 - (
                              3 * x43 * (x47 / (x47 + 1 / 5) + (4 * x48) / (25 * (x48 + 1 / 2) * (x47 + 1 / 5)))) / (
                              x43 / x44 + 1 / 10)),
        1 / 96 * ((x31 * (Q0 + Qa + 18446)) / 1333 - (3 * x44) / 10 - (x44 * (Q0 + Qa + 18446)) / 1333 + (
                    4 * x41 * x44 * x47) / ((x41 + 10) * (x47 + 1 / 5)) + (16 * x41 * x44 * x48) / (
                              25 * (x41 + 10) * (x48 + 1 / 2) * (x47 + 1 / 5))),
        1 / 96 * ((x32 * (Q0 + Qa + 18446)) / 1333 - x45 / 20 - (x45 * (Q0 + Qa + 18446)) / 1333 + (x45 * x47 * x49) / (
                    2 * (x49 + 1) * (x47 + 2 / 5))),
        1 / 96 * ((3 * x44) / 125 + x45 / 250 + (x33 * (Q0 + Qa + 18446)) / 1333 - (x46 * (Q0 + Qa + 18446)) / 1333),
        1 / 96 * ((x34 * (Q0 + Qa + 18446)) / 1333 - 240 * x47 - (x47 * (Q0 + Qa + 18446)) / 1333 - (
                    132 * x41 * x44 * x47) / (67 * (x41 + 10) * (x47 + 1 / 5)) - (433 * x45 * x47 * x49) / (
                              48 * (x49 + 1) * (x47 + 2 / 5)) + 1920),
        1 / 96 * ((x35 * (Q0 + Qa + 18446)) / 1333 - (x48 * (Q0 + Qa + 18446)) / 1333 + (25 * x45 * x47 * x49) / (
                    12 * (x49 + 1) * (x47 + 2 / 5)) - (96 * x41 * x44 * x48) / (
                              871 * (x41 + 10) * (x48 + 1 / 2) * (x47 + 1 / 5))),
        1 / 96 * ((x44 * x50) / 20 + (x36 * (Q0 + Qa + 18446)) / 1333 - (x49 * (Q0 + Qa + 18446)) / 1333 - (
                    8 * x41 * x44 * x47) / (25 * (x41 + 10) * (x47 + 1 / 5)) - (637 * x45 * x47 * x49) / (
                              300 * (x49 + 1) * (x47 + 2 / 5)) - (32 * x41 * x44 * x48) / (
                              625 * (x41 + 10) * (x48 + 1 / 2) * (x47 + 1 / 5))),
        1 / 96 * ((x37 * (Q0 + Qa + 18446)) / 1333 - (x44 * x50) / 20 - (x50 * (Q0 + Qa + 18446)) / 1333 + (
                    3 * x51 * (x47 / (x47 + 1 / 5) + (4 * x48) / (25 * (x48 + 1 / 2) * (x47 + 1 / 5)))) / (
                              x43 / x44 + 1 / 10)),
        1 / 96 * ((141 * x44) / 6250 + (47 * x45) / 12500 + (x38 * (Q0 + Qa + 18446)) / 1333 - (
                    x51 * (Q0 + Qa + 18446)) / 1333 - (
                              3 * x51 * (x47 / (x47 + 1 / 5) + (4 * x48) / (25 * (x48 + 1 / 2) * (x47 + 1 / 5)))) / (
                              x43 / x44 + 1 / 10)),
        1 / 96 * ((x44 * x50) / 280 + (x39 * (Q0 + Qa + 18446)) / 1333 - (x52 * (Q0 + Qa + 18446)) / 1333 - (
                    4 * x41 * x44 * x47) / (175 * (x41 + 10) * (x47 + 1 / 5)) - (631 * x45 * x47 * x49) / (
                              2100 * (x49 + 1) * (x47 + 2 / 5)) + (1518823277841921 * x41 * x44 * x48) / (
                              360287970189639680 * (x41 + 10) * (x48 + 1 / 2) * (x47 + 1 / 5))),
        1 / 96 * ((x40 * (Q0 + Qa + 18446)) / 1333 - (x53 * (Q0 + Qa + 18446)) / 1333),
        1 / 96 * ((x41 * (Q0 + Qa + 18446)) / 1333 - (x54 * (Q0 + Qa + 18446)) / 1333 + (
                    3 * x56 * (x60 / (x60 + 1 / 5) + (4 * x61) / (25 * (x61 + 1 / 2) * (x60 + 1 / 5)))) / (
                              x56 / x57 + 1 / 10) - (400 * x54 * x57 * x60) / (67 * (x54 + 10) * (x60 + 1 / 5)) - (
                              64 * x54 * x57 * x61) / (67 * (x54 + 10) * (x61 + 1 / 2) * (x60 + 1 / 5))),
        1 / 96 * ((x42 * (Q0 + Qa + 18446)) / 1333 - (x55 * (Q0 + Qa + 18446)) / 1333),
        1 / 96 * ((69 * x57) / 250 + (23 * x58) / 500 + (x43 * (Q0 + Qa + 18446)) / 1333 - (
                    x56 * (Q0 + Qa + 18446)) / 1333 - (
                              3 * x56 * (x60 / (x60 + 1 / 5) + (4 * x61) / (25 * (x61 + 1 / 2) * (x60 + 1 / 5)))) / (
                              x56 / x57 + 1 / 10)),
        1 / 96 * ((x44 * (Q0 + Qa + 18446)) / 1333 - (3 * x57) / 10 - (x57 * (Q0 + Qa + 18446)) / 1333 + (
                    4 * x54 * x57 * x60) / ((x54 + 10) * (x60 + 1 / 5)) + (16 * x54 * x57 * x61) / (
                              25 * (x54 + 10) * (x61 + 1 / 2) * (x60 + 1 / 5))),
        1 / 96 * ((x45 * (Q0 + Qa + 18446)) / 1333 - x58 / 20 - (x58 * (Q0 + Qa + 18446)) / 1333 + (x58 * x60 * x62) / (
                    2 * (x62 + 1) * (x60 + 2 / 5))),
        1 / 96 * ((3 * x57) / 125 + x58 / 250 + (x46 * (Q0 + Qa + 18446)) / 1333 - (x59 * (Q0 + Qa + 18446)) / 1333),
        1 / 96 * ((x47 * (Q0 + Qa + 18446)) / 1333 - KLa5 * (x60 - 8) - (x60 * (Q0 + Qa + 18446)) / 1333 - (
                    132 * x54 * x57 * x60) / (67 * (x54 + 10) * (x60 + 1 / 5)) - (433 * x58 * x60 * x62) / (
                              48 * (x62 + 1) * (x60 + 2 / 5))),
        1 / 96 * ((x48 * (Q0 + Qa + 18446)) / 1333 - (x61 * (Q0 + Qa + 18446)) / 1333 + (25 * x58 * x60 * x62) / (
                    12 * (x62 + 1) * (x60 + 2 / 5)) - (96 * x54 * x57 * x61) / (
                              871 * (x54 + 10) * (x61 + 1 / 2) * (x60 + 1 / 5))),
        1 / 96 * ((x57 * x63) / 20 + (x49 * (Q0 + Qa + 18446)) / 1333 - (x62 * (Q0 + Qa + 18446)) / 1333 - (
                    8 * x54 * x57 * x60) / (25 * (x54 + 10) * (x60 + 1 / 5)) - (637 * x58 * x60 * x62) / (
                              300 * (x62 + 1) * (x60 + 2 / 5)) - (32 * x54 * x57 * x61) / (
                              625 * (x54 + 10) * (x61 + 1 / 2) * (x60 + 1 / 5))),
        1 / 96 * ((x50 * (Q0 + Qa + 18446)) / 1333 - (x57 * x63) / 20 - (x63 * (Q0 + Qa + 18446)) / 1333 + (
                    3 * x64 * (x60 / (x60 + 1 / 5) + (4 * x61) / (25 * (x61 + 1 / 2) * (x60 + 1 / 5)))) / (
                              x56 / x57 + 1 / 10)),
        1 / 96 * ((141 * x57) / 6250 + (47 * x58) / 12500 + (x51 * (Q0 + Qa + 18446)) / 1333 - (
                    x64 * (Q0 + Qa + 18446)) / 1333 - (
                              3 * x64 * (x60 / (x60 + 1 / 5) + (4 * x61) / (25 * (x61 + 1 / 2) * (x60 + 1 / 5)))) / (
                              x56 / x57 + 1 / 10)),
        1 / 96 * ((x57 * x63) / 280 + (x52 * (Q0 + Qa + 18446)) / 1333 - (x65 * (Q0 + Qa + 18446)) / 1333 - (
                    4 * x54 * x57 * x60) / (175 * (x54 + 10) * (x60 + 1 / 5)) - (631 * x58 * x60 * x62) / (
                              2100 * (x62 + 1) * (x60 + 2 / 5)) + (1518823277841921 * x54 * x57 * x61) / (
                              360287970189639680 * (x54 + 10) * (x61 + 1 / 2) * (x60 + 1 / 5))),
        1 / 96 * ((6277 * x67) / 200 - (6277 * x66) / 200 + (5 * x67 * (474 * np.exp(
            (1539 * x55) / 1562500000 + (1539 * x56) / 1562500000 + (1539 * x57) / 1562500000 + (
                        1539 * x58) / 1562500000 + (1539 * x59) / 1562500000 - (9 * x67) / 15625) - 474 * np.exp(
            (24453 * x55) / 5000000000 + (24453 * x56) / 5000000000 + (24453 * x57) / 5000000000 + (
                        24453 * x58) / 5000000000 + (24453 * x59) / 5000000000 - (143 * x67) / 50000))) / 2),
        1 / 96 * ((6277 * x68) / 200 - (6277 * x67) / 200 - (5 * x67 * (474 * np.exp(
            (1539 * x55) / 1562500000 + (1539 * x56) / 1562500000 + (1539 * x57) / 1562500000 + (
                        1539 * x58) / 1562500000 + (1539 * x59) / 1562500000 - (9 * x67) / 15625) - 474 * np.exp(
            (24453 * x55) / 5000000000 + (24453 * x56) / 5000000000 + (24453 * x57) / 5000000000 + (
                        24453 * x58) / 5000000000 + (24453 * x59) / 5000000000 - (143 * x67) / 50000))) / 2 + (
                              5 * x68 * (474 * np.exp(
                          (1539 * x55) / 1562500000 + (1539 * x56) / 1562500000 + (1539 * x57) / 1562500000 + (
                                      1539 * x58) / 1562500000 + (1539 * x59) / 1562500000 - (
                                      9 * x68) / 15625) - 474 * np.exp(
                          (24453 * x55) / 5000000000 + (24453 * x56) / 5000000000 + (24453 * x57) / 5000000000 + (
                                      24453 * x58) / 5000000000 + (24453 * x59) / 5000000000 - (
                                      143 * x68) / 50000))) / 2),
        1 / 96 * ((6277 * x69) / 200 - (6277 * x68) / 200),
        1 / 96 * ((6277 * x70) / 200 - (6277 * x69) / 200 - (5 * x68 * (474 * np.exp(
            (1539 * x55) / 1562500000 + (1539 * x56) / 1562500000 + (1539 * x57) / 1562500000 + (
                        1539 * x58) / 1562500000 + (1539 * x59) / 1562500000 - (9 * x68) / 15625) - 474 * np.exp(
            (24453 * x55) / 5000000000 + (24453 * x56) / 5000000000 + (24453 * x57) / 5000000000 + (
                        24453 * x58) / 5000000000 + (24453 * x59) / 5000000000 - (143 * x68) / 50000))) / 2 + (
                              5 * x70 * (474 * np.exp(
                          (1539 * x55) / 1562500000 + (1539 * x56) / 1562500000 + (1539 * x57) / 1562500000 + (
                                      1539 * x58) / 1562500000 + (1539 * x59) / 1562500000 - (
                                      9 * x70) / 15625) - 474 * np.exp(
                          (24453 * x55) / 5000000000 + (24453 * x56) / 5000000000 + (24453 * x57) / 5000000000 + (
                                      24453 * x58) / 5000000000 + (24453 * x59) / 5000000000 - (
                                      143 * x70) / 50000))) / 2),
        1 / 96 * ((6277 * x71) / 200 - (6277 * x70) / 200),
        1 / 96 * ((5 * x72 * (474 * np.exp(
            (1539 * x55) / 1562500000 + (1539 * x56) / 1562500000 + (1539 * x57) / 1562500000 + (
                        1539 * x58) / 1562500000 + (1539 * x59) / 1562500000 - (9 * x72) / 15625) - 474 * np.exp(
            (24453 * x55) / 5000000000 + (24453 * x56) / 5000000000 + (24453 * x57) / 5000000000 + (
                        24453 * x58) / 5000000000 + (24453 * x59) / 5000000000 - (143 * x72) / 50000))) / 2 - (
                              5 * x70 * (474 * np.exp(
                          (1539 * x55) / 1562500000 + (1539 * x56) / 1562500000 + (1539 * x57) / 1562500000 + (
                                      1539 * x58) / 1562500000 + (1539 * x59) / 1562500000 - (
                                      9 * x70) / 15625) - 474 * np.exp(
                          (24453 * x55) / 5000000000 + (24453 * x56) / 5000000000 + (24453 * x57) / 5000000000 + (
                                      24453 * x58) / 5000000000 + (24453 * x59) / 5000000000 - (
                                      143 * x70) / 50000))) / 2 + ((Q0 + 18446) * (
                    (3 * x55) / 4 + (3 * x56) / 4 + (3 * x57) / 4 + (3 * x58) / 4 + (3 * x59) / 4)) / 600 - (
                              5 * x71 * (Q0 / 1500 + 9223 / 750)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x71 - x72)) / 2 - (5 * x72 * (474 * np.exp(
            (1539 * x55) / 1562500000 + (1539 * x56) / 1562500000 + (1539 * x57) / 1562500000 + (
                        1539 * x58) / 1562500000 + (1539 * x59) / 1562500000 - (9 * x72) / 15625) - 474 * np.exp(
            (24453 * x55) / 5000000000 + (24453 * x56) / 5000000000 + (24453 * x57) / 5000000000 + (
                        24453 * x58) / 5000000000 + (24453 * x59) / 5000000000 - (143 * x72) / 50000))) / 2 + (
                              5 * x73 * (474 * np.exp(
                          (1539 * x55) / 1562500000 + (1539 * x56) / 1562500000 + (1539 * x57) / 1562500000 + (
                                      1539 * x58) / 1562500000 + (1539 * x59) / 1562500000 - (
                                      9 * x73) / 15625) - 474 * np.exp(
                          (24453 * x55) / 5000000000 + (24453 * x56) / 5000000000 + (24453 * x57) / 5000000000 + (
                                      24453 * x58) / 5000000000 + (24453 * x59) / 5000000000 - (
                                      143 * x73) / 50000))) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x72 - x73)) / 2 - (5 * x73 * (474 * np.exp(
            (1539 * x55) / 1562500000 + (1539 * x56) / 1562500000 + (1539 * x57) / 1562500000 + (
                        1539 * x58) / 1562500000 + (1539 * x59) / 1562500000 - (9 * x73) / 15625) - 474 * np.exp(
            (24453 * x55) / 5000000000 + (24453 * x56) / 5000000000 + (24453 * x57) / 5000000000 + (
                        24453 * x58) / 5000000000 + (24453 * x59) / 5000000000 - (143 * x73) / 50000))) / 2 + (
                              5 * x74 * (474 * np.exp(
                          (1539 * x55) / 1562500000 + (1539 * x56) / 1562500000 + (1539 * x57) / 1562500000 + (
                                      1539 * x58) / 1562500000 + (1539 * x59) / 1562500000 - (
                                      9 * x74) / 15625) - 474 * np.exp(
                          (24453 * x55) / 5000000000 + (24453 * x56) / 5000000000 + (24453 * x57) / 5000000000 + (
                                      24453 * x58) / 5000000000 + (24453 * x59) / 5000000000 - (
                                      143 * x74) / 50000))) / 2),

        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x73 - x74)) / 2 - (5 * x74 * (474 * np.exp(
            (1539 * x55) / 1562500000 + (1539 * x56) / 1562500000 + (1539 * x57) / 1562500000 + (
                        1539 * x58) / 1562500000 + (1539 * x59) / 1562500000 - (9 * x74) / 15625) - 474 * np.exp(
            (24453 * x55) / 5000000000 + (24453 * x56) / 5000000000 + (24453 * x57) / 5000000000 + (
                        24453 * x58) / 5000000000 + (24453 * x59) / 5000000000 - (143 * x74) / 50000))) / 2 + (
                              5 * x75 * (474 * np.exp(
                          (1539 * x55) / 1562500000 + (1539 * x56) / 1562500000 + (1539 * x57) / 1562500000 + (
                                      1539 * x58) / 1562500000 + (1539 * x59) / 1562500000 - (
                                      9 * x75) / 15625) - 474 * np.exp(
                          (24453 * x55) / 5000000000 + (24453 * x56) / 5000000000 + (24453 * x57) / 5000000000 + (
                                      24453 * x58) / 5000000000 + (24453 * x59) / 5000000000 - (
                                      143 * x75) / 50000))) / 2),

        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x74 - x75)) / 2 - (5 * x75 * (474 * np.exp(
            (1539 * x55) / 1562500000 + (1539 * x56) / 1562500000 + (1539 * x57) / 1562500000 + (
                        1539 * x58) / 1562500000 + (1539 * x59) / 1562500000 - (9 * x75) / 15625) - 474 * np.exp(
            (24453 * x55) / 5000000000 + (24453 * x56) / 5000000000 + (24453 * x57) / 5000000000 + (
                        24453 * x58) / 5000000000 + (24453 * x59) / 5000000000 - (143 * x75) / 50000))) / 2),
        1 / 96 * ((6277 * x77) / 200 - (6277 * x76) / 200),
        1 / 96 * ((6277 * x78) / 200 - (6277 * x77) / 200),
        1 / 96 * ((6277 * x79) / 200 - (6277 * x78) / 200),

        1 / 96 * ((6277 * x80) / 200 - (6277 * x79) / 200),
        1 / 96 * ((6277 * x81) / 200 - (6277 * x80) / 200),
        1 / 96 * ((x53 * (Q0 + 18446)) / 600 - (5 * x81 * (Q0 / 1500 + 9223 / 750)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x81 - x82)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x82 - x83)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x83 - x84)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x84 - x85)) / 2),
        1 / 96 * ((6277 * x87) / 200 - (6277 * x86) / 200),
        1 / 96 * ((6277 * x88) / 200 - (6277 * x87) / 200),
        1 / 96 * ((6277 * x89) / 200 - (6277 * x88) / 200),
        1 / 96 * ((6277 * x90) / 200 - (6277 * x89) / 200),
        1 / 96 * ((6277 * x91) / 200 - (6277 * x90) / 200),
        1 / 96 * ((x54 * (Q0 + 18446)) / 600 - (5 * x91 * (Q0 / 1500 + 9223 / 750)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x91 - x92)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x92 - x93)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x93 - x94)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x94 - x95)) / 2),
        1 / 96 * ((6277 * x97) / 200 - (6277 * x96) / 200),
        1 / 96 * ((6277 * x98) / 200 - (6277 * x97) / 200),
        1 / 96 * ((6277 * x99) / 200 - (6277 * x98) / 200),
        1 / 96 * ((6277 * x100) / 200 - (6277 * x99) / 200),
        1 / 96 * ((6277 * x101) / 200 - (6277 * x100) / 200),
        1 / 96 * ((x60 * (Q0 + 18446)) / 600 - (5 * x101 * (Q0 / 1500 + 9223 / 750)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x101 - x102)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x102 - x103)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x103 - x104)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x104 - x105)) / 2),
        1 / 96 * ((6277 * x107) / 200 - (6277 * x106) / 200),

        1 / 96 * ((6277 * x108) / 200 - (6277 * x107) / 200),
        1 / 96 * ((6277 * x109) / 200 - (6277 * x108) / 200),
        1 / 96 * ((6277 * x110) / 200 - (6277 * x109) / 200),
        1 / 96 * ((6277 * x111) / 200 - (6277 * x110) / 200),
        1 / 96 * ((x61 * (Q0 + 18446)) / 600 - (5 * x111 * (Q0 / 1500 + 9223 / 750)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x111 - x112)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x112 - x113)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x113 - x114)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x114 - x115)) / 2),
        1 / 96 * ((6277 * x117) / 200 - (6277 * x116) / 200),
        1 / 96 * ((6277 * x118) / 200 - (6277 * x117) / 200),
        1 / 96 * ((6277 * x119) / 200 - (6277 * x118) / 200),
        1 / 96 * ((6277 * x120) / 200 - (6277 * x119) / 200),
        1 / 96 * ((6277 * x121) / 200 - (6277 * x120) / 200),
        1 / 96 * ((x62 * (Q0 + 18446)) / 600 - (5 * x121 * (Q0 / 1500 + 9223 / 750)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x121 - x122)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x122 - x123)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x123 - x124)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x124 - x125)) / 2),
        1 / 96 * ((6277 * x127) / 200 - (6277 * x126) / 200),
        1 / 96 * ((6277 * x128) / 200 - (6277 * x127) / 200),
        1 / 96 * ((6277 * x129) / 200 - (6277 * x128) / 200),
        1 / 96 * ((6277 * x130) / 200 - (6277 * x129) / 200),
        1 / 96 * ((6277 * x131) / 200 - (6277 * x130) / 200),
        1 / 96 * ((x63 * (Q0 + 18446)) / 600 - (5 * x131 * (Q0 / 1500 + 9223 / 750)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x131 - x132)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x132 - x133)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x133 - x134)) / 2),

        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x134 - x135)) / 2),
        1 / 96 * ((6277 * x137) / 200 - (6277 * x136) / 200),
        1 / 96 * ((6277 * x138) / 200 - (6277 * x137) / 200),
        1 / 96 * ((6277 * x139) / 200 - (6277 * x138) / 200),
        1 / 96 * ((6277 * x140) / 200 - (6277 * x139) / 200),
        1 / 96 * ((6277 * x141) / 200 - (6277 * x140) / 200),
        1 / 96 * ((x65 * (Q0 + 18446)) / 600 - (5 * x141 * (Q0 / 1500 + 9223 / 750)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x141 - x142)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x142 - x143)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x143 - x144)) / 2),
        1 / 96 * ((5 * (Q0 / 1500 - 77 / 300) * (x144 - x145)) / 2),
    ]

    return np.array(dxdt)

def main():
    env = waste_water_system()
    T = 1344
    cost = 0
    path = []
    a_path = []
    t1 = []
    s = env.reset()
    for i in range(int(T)):
        action = env.get_action()
        s, r, done, info = env.step(action)
        path.append(s)
        cost += r
        a_path.append(action)
        t1.append(i)
    path = np.array(path)
    state_dim = 2
    fig, ax = plt.subplots(state_dim, sharex=True, figsize=(15, 15))
    t = range(T)
    for i in range(state_dim):
        ax[i].plot(t, path[:, i], color='red')
    # fig = plt.figure(figsize=(9, 6))
    # ax = fig.add_subplot(111)
    # ax.plot(t1, path)
    # # ax.plot(t2, path2, color='red',label='1')
    # #
    # # ax.plot(t3, path3, color='black', label='0.01')
    # # ax.plot(t4, path4, color='orange', label='0.001')
    # handles, labels = ax.get_legend_handles_labels()
    #
    # ax.legend(handles, labels, loc=2, fancybox=False, shadow=False)
    # plt.show()
    # print('done')

    fig = plt.figure(figsize=(9, 6))
    ax = fig.add_subplot(111)
    ax.plot(t1, a_path)
    # ax.plot(t2, path2, color='red',label='1')
    #
    # ax.plot(t3, path3, color='black', label='0.01')
    # ax.plot(t4, path4, color='orange', label='0.001')
    handles, labels = ax.get_legend_handles_labels()

    save_data = np.array(path)
    np.savetxt('data.txt',save_data)

    ax.legend(handles, labels, loc=2, fancybox=False, shadow=False)
    plt.show()
    print('done')


if __name__=='__main__':
    main()










